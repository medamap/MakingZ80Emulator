# Z80 エミュレータ実装ガイド

## **1. Z80 の概要**
### **1.1 Z80 の特徴**
- **1976 年に Zilog が開発した 8 ビット CPU**
- **Intel 8080 の上位互換**（バイナリ互換）
- **+5V 単一電源、単相クロック**
- **最大 64KB のメモリアドレス空間**
- **レジスタ構成の拡張**
  - インデックスレジスタ（IX, IY）
  - 裏レジスタ（AF', BC', DE', HL'）
  - DRAM リフレッシュ用 R レジスタ
- **割り込みモードの拡張（IM 0, 1, 2）**
- **追加命令**
  - **相対ジャンプ (`JR e`)**
  - **ブロック転送 (`LDIR`)**
  - **ビット操作 (`BIT, SET, RES`)**
  - **間接 I/O (`IN r, (C)`, `OUT (C), r`)**

---

## **2. ハードウェア構成**
### **2.1 バス構成**
| 信号線 | 説明 |
|--------|------|
| **アドレスバス (A0-A15)** | **16bit（最大 64KB メモリ）** |
| **データバス (D0-D7)** | **8bit（1バイト単位でデータ転送）** |
| **/MREQ (Memory Request)** | メモリアクセス時にアクティブ |
| **/IORQ (I/O Request)** | I/O アクセス時にアクティブ |
| **/RD /WR** | 読み書き制御 |
| **/WAIT** | 周辺デバイスの遅延処理 |
| **/BUSRQ /BUSAK** | バス制御 |
| **/RFSH** | DRAM のリフレッシュ |
| **/M1** | 命令フェッチの識別 |
| **/HALT** | `HALT` 命令時の停止 |
| **/RESET** | リセット時に `PC = 0000H` |

### **2.2 割り込み**
| 割り込み | 概要 |
|---------|------|
| **/INT（マスカブル割り込み）** | `EI`/`DI` で制御可能 |
| **/NMI（ノンマスカブル割り込み）** | 強制割り込み（アドレス `66H`） |
| **IM 0** | 8080 互換、バスから命令取得 |
| **IM 1** | 固定アドレス `38H` へジャンプ |
| **IM 2** | ベクタテーブルを使用（最大 128 個） |

---

## **3. レジスタ構成**
### **3.1 汎用レジスタ**
| レジスタ | 説明 |
|---------|------|
| **A** | アキュムレータ（演算結果格納） |
| **B, C, D, E, H, L** | 汎用レジスタ（ペア使用可） |
| **AF, BC, DE, HL** | 16bit 組み合わせ |

### **3.2 特殊レジスタ**
| レジスタ | 説明 |
|---------|------|
| **IX, IY** | インデックスレジスタ（間接アドレッシング） |
| **SP** | スタックポインタ |
| **PC** | プログラムカウンタ |
| **I** | 割り込みベクタレジスタ |
| **R** | DRAM リフレッシュカウンタ |
| **IFF1, IFF2** | 割り込み制御フリップフロップ |

### **3.3 フラグレジスタ (F)**
| ビット | 名称 | 説明 |
|------|------|------|
| 7 | S (Sign) | 負なら 1, 正なら 0 |
| 6 | Z (Zero) | 演算結果が 0 なら 1 |
| 4 | H (Half Carry) | BCD 用キャリー |
| 2 | P/V (Parity/Overflow) | パリティ/オーバーフロー |
| 1 | N (Subtract) | `SUB` 実行時に 1 |
| 0 | C (Carry) | キャリーフラグ |

---

## **4. 命令セット**
### **4.1 データ転送**
| 命令 | 機能 |
|------|------|
| `LD r, r'` | レジスタ間転送 |
| `LD r, (HL)` | メモリ → レジスタ |
| `LD (HL), r` | レジスタ → メモリ |
| `LD r, n` | 即値ロード |
| `PUSH rp` | スタックへ保存 |
| `POP rp` | スタックから復元 |

### **4.2 算術・論理演算**
| 命令 | 機能 |
|------|------|
| `ADD A, r` | A + r |
| `SUB r` | A - r |
| `AND r` | A & r |
| `XOR r` | A ^ r |
| `CP r` | A - r の比較 |
| `INC r` | r + 1 |
| `DEC r` | r - 1 |

### **4.3 ビット操作**
| 命令 | 機能 |
|------|------|
| `BIT b, r` | r の b ビット判定 |
| `SET b, r` | r の b ビットを 1 |
| `RES b, r` | r の b ビットを 0 |

### **4.4 制御フロー**
| 命令 | 機能 |
|------|------|
| `JP nn` | 無条件ジャンプ |
| `JR e` | 相対ジャンプ |
| `CALL nn` | サブルーチン呼び出し |
| `RET` | サブルーチン復帰 |

### **4.5 入出力**
| 命令 | 機能 |
|------|------|
| `IN A, (n)` | I/O ポート入力 |
| `OUT (n), A` | I/O ポート出力 |

---

## **5. 命令実行サイクル**
### **5.1 基本的な命令実行の流れ**
1. **フェッチ (M1サイクル)**  
   - メモリからオペコードを取得
2. **デコード**  
   - 命令の種類を判別
3. **オペランド取得 (M2, M3サイクル)**  
   - レジスタまたはメモリからデータ取得
4. **実行**  
   - 算術・論理演算、メモリアクセスなど
5. **PC 更新**  
   - 次の命令アドレスへ

### **5.2 タイミングとサイクル**
- **T サイクル**: クロック 1 周期  
- **M サイクル**: 機能単位の動作（例: M1, メモリアクセス）  
- **M1 サイクル**: 命令フェッチ時の特別なサイクル  
- **WAIT 信号**: 遅いメモリ/I/O への対応  

### **5.3 実行時間の計算**
- `LD A, B` → **4T + 1WAIT**
- `ADC HL, HL` (0xED) → **15T + 2WAIT**

---

## **6. エミュレータ実装のポイント**
1. **命令デコード**
   - 8080 互換命令 + Z80 拡張命令
2. **クロック管理**
   - `M1` サイクルの最適化、WAIT の再現
3. **メモリアクセス**
   - `64KB` メモリマップ、バンク切り替え
4. **割り込み処理**
   - `IM 0 / 1 / 2` の正確なエミュレーション
5. **I/O 処理**
   - `IN` / `OUT` 命令のサポート
6. **DMA & スタック**
   - `BUSRQ` / `BUSAK` の処理、PUSH/POP の再現



# Z80 8ビット転送命令

このドキュメントは Z80 の **8ビット転送命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **8ビット転送命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| LD r, r' | r ← r' | - - - - - - | 01rrr rrr | 1 | 4 | 4 | レジスタ間転送 |
| LD r, n | r ← n | - - - - - - | 00rrr 110 | 2 | 7 | 7 | 即値ロード |
| LD r, (HL) | r ← (HL) | - - - - - - | 01rrr 110 | 1 | 7 | 7 | メモリアクセス |
| LD r, (IX+d) | r ← (IX+d) | - - - - - - | (DD) 01rrr 110 | 3 | 19 | 19 | インデックス付き |
| LD r, (IY+d) | r ← (IY+d) | - - - - - - | (FD) 01rrr 110 | 3 | 19 | 19 | インデックス付き |
| LD (HL), r | (HL) ← r | - - - - - - | 011110rrr | 1 | 7 | 7 | メモリアクセス |
| LD (IX+d), r | (IX+d) ← r | - - - - - - | (DD) 01110rrr | 3 | 19 | 19 | インデックス付き |
| LD (IY+d), r | (IY+d) ← r | - - - - - - | (FD) 01110rrr | 3 | 19 | 19 | インデックス付き |
| LD (HL), n | (HL) ← n | - - - - - - | 36 nn | 2 | 10 | 10 | 即値 |
| LD (IX+d), n | (IX+d) ← n | - - - - - - | (DD) 36 nn | 4 | 19 | 19 | インデックス即値 |
| LD (IY+d), n | (IY+d) ← n | - - - - - - | (FD) 36 nn | 4 | 19 | 19 | インデックス即値 |
| LD A, (BC) | A ← (BC) | - - - - - - | 0A | 1 | 7 | 7 | メモリ間接 |
| LD A, (DE) | A ← (DE) | - - - - - - | 1A | 1 | 7 | 7 | メモリ間接 |
| LD A, (nn) | A ← (nn) | - - - - - - | 3A nn nn | 3 | 13 | 13 | メモリ間接 |
| LD (BC), A | (BC) ← A | - - - - - - | 02 | 1 | 7 | 7 | メモリ間接 |
| LD (DE), A | (DE) ← A | - - - - - - | 12 | 1 | 7 | 7 | メモリ間接 |
| LD (nn), A | (nn) ← A | - - - - - - | 32 nn nn | 3 | 13 | 13 | メモリ間接 |
| LD A, I | A ← I | * 0 * 0 * * | ED 57 | 2 | 9 | 9 | IFF2 の状態が P/V に入る |
| LD A, R | A ← R | * 0 * 0 * * | ED 5F | 2 | 9 | 9 | IFF2 の状態が P/V に入る |
| LD I, A | I ← A | - - - - - - | ED 47 | 2 | 9 | 9 | - |
| LD R, A | R ← A | - - - - - - | ED 4F | 2 | 9 | 9 | - |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `-` = 無変化
- `*` = 変化あり
- `0` = リセット
- `1` = セット

---

## **📌 レジスタ対応表**
| `rrr` の値 | レジスタ |
|------------|---------|
| `000` | `B` |
| `001` | `C` |
| `010` | `D` |
| `011` | `E` |
| `100` | `H` |
| `101` | `L` |
| `110` | `(HL)` |
| `111` | `A` |

---

## **📌 補足情報**
- `(IX+d)` や `(IY+d)` は **IX, IY レジスタを基準としたオフセットメモリアクセス**
- `n` は **8ビット即値**
- `nn` は **16ビット即値アドレス**
- `IFF2` の状態が `P/V` フラグに影響する特殊命令あり

---

## **📌 例: 命令のオペコード**
**LD A, 32 の場合**
```assembly
LD A, 32  ; A ← 32 をロード





# Z80 16ビット・ロード命令

このドキュメントは Z80 の **16ビット・ロード命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **16ビット・ロード命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| LD dd, nn | dd ← nn | - - - - - - | 00dd 0001 | 3 | 10 | 10 | `dd` = `BC`, `DE`, `HL`, `SP` |
| LD IX, nn | IX ← nn | - - - - - - | (DD) 21 | 4 | 14 | 14 | - |
| LD IY, nn | IY ← nn | - - - - - - | (FD) 21 | 4 | 14 | 14 | - |
| LD HL, (nn) | HL ← (nn) | - - - - - - | 2A nn nn | 3 | 16 | 16 | `nn` はアドレス |
| LD dd, (nn) | dd ← (nn) | - - - - - - | (ED) 01dd 1011 | 4 | 20 | 20 | `dd` = `BC`, `DE`, `HL`, `SP` |
| LD IX, (nn) | IX ← (nn) | - - - - - - | (DD) 2A | 4 | 20 | 20 | `nn` はアドレス |
| LD IY, (nn) | IY ← (nn) | - - - - - - | (FD) 2A | 4 | 20 | 20 | `nn` はアドレス |
| LD (nn), HL | (nn) ← HL | - - - - - - | 22 nn nn | 3 | 16 | 16 | `nn` はアドレス |
| LD (nn), dd | (nn) ← dd | - - - - - - | (ED) 01dd 0011 | 4 | 20 | 20 | `dd` = `BC`, `DE`, `HL`, `SP` |
| LD (nn), IX | (nn) ← IX | - - - - - - | (DD) 22 | 4 | 20 | 20 | `nn` はアドレス |
| LD (nn), IY | (nn) ← IY | - - - - - - | (FD) 22 | 4 | 20 | 20 | `nn` はアドレス |
| LD SP, HL | SP ← HL | - - - - - - | F9 | 1 | 6 | 6 | - |
| LD SP, IX | SP ← IX | - - - - - - | (DD) F9 | 2 | 10 | 10 | - |
| LD SP, IY | SP ← IY | - - - - - - | (FD) F9 | 2 | 10 | 10 | - |
| PUSH qq | (SP-2) ← qq | - - - - - - | 11qq 0101 | 1 | 11 | 11 | `qq` = `BC`, `DE`, `HL`, `AF` |
| PUSH IX | (SP-2) ← IX | - - - - - - | (DD) E5 | 2 | 15 | 15 | - |
| PUSH IY | (SP-2) ← IY | - - - - - - | (FD) E5 | 2 | 15 | 15 | - |
| POP qq | qq ← (SP) | - - - - - - | 11qq 0001 | 1 | 10 | 10 | `qq` = `BC`, `DE`, `HL`, `AF` |
| POP IX | IX ← (SP) | - - - - - - | (DD) E1 | 2 | 14 | 14 | - |
| POP IY | IY ← (SP) | - - - - - - | (FD) E1 | 2 | 14 | 14 | - |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `-` = 無変化

---

## **📌 レジスタ対応表**
| `dd` の値 | レジスタ | `qq` の値 | レジスタ |
|------------|---------|------------|---------|
| `00` | `BC` | `00` | `BC` |
| `01` | `DE` | `01` | `DE` |
| `10` | `HL` | `10` | `HL` |
| `11` | `SP` | `11` | `AF` |

---

## **📌 補足情報**
- `(nn)` は **16ビットアドレスを指すメモリ間接ロード**
- `dd` は **16ビットレジスタ (`BC`, `DE`, `HL`, `SP`)**
- `qq` は **PUSH/POP に対応するレジスタ (`BC`, `DE`, `HL`, `AF`)**
- `PUSH` は **スタックポインタ (SP) を 2 減算**
- `POP` は **スタックポインタ (SP) を 2 加算**
- `POP AF` の場合、**F レジスタの内容も復元**

---

## **📌 例: 命令のオペコード**
**LD HL, (4000h) の場合**
```assembly
LD HL, (4000h)  ; HL ← メモリ 4000h の内容をロード





# Z80 16ビット・ロード命令

このドキュメントは Z80 の **16ビット・ロード命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **16ビット・ロード命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| LD dd, nn | dd ← nn | - - - - - - | 00dd 0001 | 3 | 10 | 10 | `dd` = `BC`, `DE`, `HL`, `SP` |
| LD IX, nn | IX ← nn | - - - - - - | (DD) 21 | 4 | 14 | 14 | - |
| LD IY, nn | IY ← nn | - - - - - - | (FD) 21 | 4 | 14 | 14 | - |
| LD HL, (nn) | HL ← (nn) | - - - - - - | 2A nn nn | 3 | 16 | 16 | `nn` はアドレス |
| LD dd, (nn) | dd ← (nn) | - - - - - - | (ED) 01dd 1011 | 4 | 20 | 20 | `dd` = `BC`, `DE`, `HL`, `SP` |
| LD IX, (nn) | IX ← (nn) | - - - - - - | (DD) 2A | 4 | 20 | 20 | `nn` はアドレス |
| LD IY, (nn) | IY ← (nn) | - - - - - - | (FD) 2A | 4 | 20 | 20 | `nn` はアドレス |
| LD (nn), HL | (nn) ← HL | - - - - - - | 22 nn nn | 3 | 16 | 16 | `nn` はアドレス |
| LD (nn), dd | (nn) ← dd | - - - - - - | (ED) 01dd 0011 | 4 | 20 | 20 | `dd` = `BC`, `DE`, `HL`, `SP` |
| LD (nn), IX | (nn) ← IX | - - - - - - | (DD) 22 | 4 | 20 | 20 | `nn` はアドレス |
| LD (nn), IY | (nn) ← IY | - - - - - - | (FD) 22 | 4 | 20 | 20 | `nn` はアドレス |
| LD SP, HL | SP ← HL | - - - - - - | F9 | 1 | 6 | 6 | - |
| LD SP, IX | SP ← IX | - - - - - - | (DD) F9 | 2 | 10 | 10 | - |
| LD SP, IY | SP ← IY | - - - - - - | (FD) F9 | 2 | 10 | 10 | - |
| PUSH qq | (SP-2) ← qq | - - - - - - | 11qq 0101 | 1 | 11 | 11 | `qq` = `BC`, `DE`, `HL`, `AF` |
| PUSH IX | (SP-2) ← IX | - - - - - - | (DD) E5 | 2 | 15 | 15 | - |
| PUSH IY | (SP-2) ← IY | - - - - - - | (FD) E5 | 2 | 15 | 15 | - |
| POP qq | qq ← (SP) | - - - - - - | 11qq 0001 | 1 | 10 | 10 | `qq` = `BC`, `DE`, `HL`, `AF` |
| POP IX | IX ← (SP) | - - - - - - | (DD) E1 | 2 | 14 | 14 | - |
| POP IY | IY ← (SP) | - - - - - - | (FD) E1 | 2 | 14 | 14 | - |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `-` = 無変化

---

## **📌 レジスタ対応表**
| `dd` の値 | レジスタ | `qq` の値 | レジスタ |
|------------|---------|------------|---------|
| `00` | `BC` | `00` | `BC` |
| `01` | `DE` | `01` | `DE` |
| `10` | `HL` | `10` | `HL` |
| `11` | `SP` | `11` | `AF` |

---

## **📌 補足情報**
- `(nn)` は **16ビットアドレスを指すメモリ間接ロード**
- `dd` は **16ビットレジスタ (`BC`, `DE`, `HL`, `SP`)**
- `qq` は **PUSH/POP に対応するレジスタ (`BC`, `DE`, `HL`, `AF`)**
- `PUSH` は **スタックポインタ (SP) を 2 減算**
- `POP` は **スタックポインタ (SP) を 2 加算**
- `POP AF` の場合、**F レジスタの内容も復元**

---

## **📌 例: 命令のオペコード**
**LD HL, (4000h) の場合**
```assembly
LD HL, (4000h)  ; HL ← メモリ 4000h の内容をロード





# Z80 8ビット算術論理演算命令

このドキュメントは Z80 の **8ビット算術論理演算命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **8ビット算術論理演算命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| ADD A, r | A ← A + r | ↑↓1↓↓0↓ | 10tt trrr | 1 | 4 | 4 | `r` は 8ビットレジスタ |
| ADD A, n | A ← A + n | ↑↓1↓↓0↓ | 110tt 110 | 2 | 7 | 7 | 即値 |
| ADD A, (HL) | A ← A + (HL) | ↑↓1↓↓0↓ | 10tt t110 | 1 | 7 | 7 | メモリ間接 |
| ADD A, (IX+d) | A ← A + (IX+d) | ↑↓1↓↓0↓ | (DD) 10tt t110 | 3 | 19 | 19 | インデックス付き |
| ADD A, (IY+d) | A ← A + (IY+d) | ↑↓1↓↓0↓ | (FD) 10tt t110 | 3 | 19 | 19 | インデックス付き |
| ADC A, s | A ← A + s + Cy | ↑↓1↓↓0↑ | 11tt t001 | 1 | 4 | 4 | `s` は `r, n, (HL), (IX+d), (IY+d)` |
| SUB A, s | A ← A - s | ↑↓1↓↓1↓ | 11tt t010 | 1 | 4 | 4 | - |
| SBC A, s | A ← A - s - Cy | ↑↓1↓↓1↑ | 11tt t011 | 1 | 4 | 4 | - |
| AND s | A ← A AND s | ↑↓1↑↓0↓ | 11tt t100 | 1 | 4 | 4 | - |
| OR s | A ← A OR s | ↑↓1↓↓0↓ | 11tt t110 | 1 | 4 | 4 | - |
| XOR s | A ← A XOR s | ↑↓1↓↓0↓ | 11tt t101 | 1 | 4 | 4 | - |
| CP s | A - s の結果をフラグに設定 | ↑↓1↓↓1↑ | 11tt t111 | 1 | 4 | 4 | 比較演算 |
| INC r | r ← r + 1 | ↑↓1↑↓0↓ | 00rrr 100 | 1 | 4 | 4 | `r` は 8ビットレジスタ |
| INC (HL) | (HL) ← (HL) + 1 | ↑↓1↑↓0↓ | 0011 0100 | 1 | 11 | 11 | メモリ間接 |
| INC (IX+d) | (IX+d) ← (IX+d) + 1 | ↑↓1↑↓0↓ | (DD) 00 11 0100 | 3 | 23 | 23 | インデックス付き |
| INC (IY+d) | (IY+d) ← (IY+d) + 1 | ↑↓1↑↓0↓ | (FD) 00 11 0100 | 3 | 23 | 23 | インデックス付き |
| DEC m | m ← m - 1 | ↑↓1↑↓1↓ | 00rrr 101 | 1 | 4 | 4 | `m` は `r, (HL), (IX+d), (IY+d)` |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `↑↓` = 変化あり
- `1` = セット
- `0` = リセット

---

## **📌 オペコードの構造**
| `ttt` の値 | 命令 | `s` の値 | 説明 |
|------------|------|------------|------|
| `000` | ADD | `r, n, (HL), (IX+d), (IY+d)` | A + s |
| `001` | ADC | `r, n, (HL), (IX+d), (IY+d)` | A + s + Cy |
| `010` | SUB | `r, n, (HL), (IX+d), (IY+d)` | A - s |
| `011` | SBC | `r, n, (HL), (IX+d), (IY+d)` | A - s - Cy |
| `100` | AND | `r, n, (HL), (IX+d), (IY+d)` | A AND s |
| `101` | XOR | `r, n, (HL), (IX+d), (IY+d)` | A XOR s |
| `110` | OR | `r, n, (HL), (IX+d), (IY+d)` | A OR s |
| `111` | CP | `r, n, (HL), (IX+d), (IY+d)` | A - s の結果をフラグに設定 |

---

## **📌 補足情報**
- `(IX+d), (IY+d)` は **IX, IY レジスタを基準としたオフセットメモリアクセス**
- `n` は **8ビット即値**
- `r` は **8ビットレジスタ (`B, C, D, E, H, L, A`)**
- `m` は **`r, (HL), (IX+d), (IY+d)` に適用可能**

---

## **📌 例: 命令のオペコード**
**ADD A, 42 の場合**
```assembly
ADD A, 42  ; A ← A + 42





# Z80 16ビット算術演算命令

このドキュメントは Z80 の **16ビット算術演算命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **16ビット算術演算命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| ADD HL, ss | HL ← HL + ss | - × - × 0 ↑ | 00ss 1001 | 1 | 11 | 11 | `ss` = `BC`, `DE`, `HL`, `SP` |
| ADC HL, ss | HL ← HL + ss + Cy | ↑ ↓ × ↓ 0 ↑ | (ED) 01ss 1010 | 2 | 15 | 15 | - |
| SBC HL, ss | HL ← HL - ss - Cy | ↑ ↓ × ↓ 1 ↑ | (ED) 01ss 0010 | 2 | 15 | 15 | - |
| ADD IX, pp | IX ← IX + pp | - × - × 0 ↑ | (DD) 00pp 1001 | 2 | 15 | 15 | `pp` = `BC`, `DE`, `IX`, `SP` |
| ADD IY, rr | IY ← IY + rr | - × - × 0 ↑ | (FD) 00rr 1001 | 2 | 15 | 15 | `rr` = `BC`, `DE`, `IY`, `SP` |
| INC ss | ss ← ss + 1 | - × - × 0 - | 00ss 0011 | 1 | 6 | 6 | `ss` = `BC`, `DE`, `HL`, `SP` |
| INC IX | IX ← IX + 1 | - - - - - - | (DD) 23 | 2 | 10 | 10 | - |
| INC IY | IY ← IY + 1 | - - - - - - | (FD) 23 | 2 | 10 | 10 | - |
| DEC ss | ss ← ss - 1 | - - - - - - | 00ss 1011 | 1 | 6 | 6 | `ss` = `BC`, `DE`, `HL`, `SP` |
| DEC IX | IX ← IX - 1 | - - - - - - | (DD) 2B | 2 | 10 | 10 | - |
| DEC IY | IY ← IY - 1 | - - - - - - | (FD) 2B | 2 | 10 | 10 | - |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `×` = 未定
- `-` = 無変化
- `0` = リセット
- `1` = セット
- `↑` = 変化あり (セット)
- `↓` = 変化あり (リセット)

---

## **📌 オペコードの構造**
| `ss` / `pp` / `rr` の値 | レジスタ |
|------------|---------|
| `00` | `BC` |
| `01` | `DE` |
| `10` | `HL` または `IX/IY` |
| `11` | `SP` |

---

## **📌 補足情報**
- `ADD HL, ss` は **HL に 16ビットレジスタを加算**
- `ADC HL, ss` は **HL + ss + キャリーフラグ**
- `SBC HL, ss` は **HL - ss - キャリーフラグ**
- `INC/DEC` は **16ビットレジスタのインクリメント・デクリメント**
- `IX, IY` に対しても `ADD, INC, DEC` が可能

---

## **📌 例: 命令のオペコード**
**ADD HL, SP の場合**
```assembly
ADD HL, SP  ; HL ← HL + SP





# Z80 アキュムレータ (Aレジスタ) 操作命令 / MPU コントロール命令

このドキュメントは Z80 の **アキュムレータ (Aレジスタ) 操作命令** および **MPU コントロール命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **アキュムレータ (Aレジスタ) 操作命令 / MPU コントロール命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| DAA | 2進化10進補正 | ↑ ↓ ↑ P - ↑ | 27 | 1 | 4 | 4 | 加減算命令実行後に実行 |
| CPL | A ← A̅ | - - 1 1 1 - | 2F | 1 | 4 | 4 | A の補数 |
| NEG | A ← -A | ↑ ↓ ↑ V 1 ↑ | (ED) 44 | 2 | 8 | 8 | 2 の補数 |
| CCF | C ← 反転 | - - 0 P - ↑ | 3F | 1 | 4 | 4 | キャリーフラグの反転 |
| SCF | C ← 1 | - - 0 0 0 1 | 37 | 1 | 4 | 4 | キャリーセット |
| NOP | No Operation | - - - - - - | 00 | 1 | 4 | 4 | 何もしない |
| HALT | 待機状態 | - - - - - - | 76 | 1 | 4 | 4 | MPU ホルト状態 |
| DI | IFF ← 0 | - - - - - - | F3 | 1 | 4 | 4 | 割込み受付禁止 |
| EI | IFF ← 1 | - - - - - - | FB | 1 | 4 | 4 | 割込み受付許可 |
| IM 0 | 割込みモード 0 | - - - - - - | (ED) 46 | 2 | 8 | 8 | RST 命令を使用 |
| IM 1 | 割込みモード 1 | - - - - - - | (ED) 56 | 2 | 8 | 8 | 割込みモード 1 のセット |
| IM 2 | 割込みモード 2 | - - - - - - | (ED) 5E | 2 | 8 | 8 | ベクター割込み |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `↑` = 変化あり (セット)
- `↓` = 変化あり (リセット)
- `-` = 無変化

---

## **📌 補足情報**
- `DAA` は **BCD 計算時に使用する補正命令**
- `CPL` は **A レジスタのビット反転**
- `NEG` は **A を負の値にする (2 の補数)**
- `CCF` は **キャリーフラグの反転**
- `SCF` は **キャリーフラグを 1 にセット**
- `HALT` は **MPU を停止し、割り込み待ち状態にする**
- `DI` は **割込みを無効化**
- `EI` は **割込みを有効化**
- `IM 0` は **割込みモード 0 (RST命令で処理)**
- `IM 1` は **割込みモード 1 (割込み許可後、自動的に RST 38h へジャンプ)**
- `IM 2` は **割込みモード 2 (ベクター割込みを使用)**

---

## **📌 例: 命令のオペコード**
**DAA の場合**
```assembly
DAA  ; A レジスタの BCD 補正





# Z80 交換命令 / ブロック転送命令 / ブロックサーチ命令

このドキュメントは Z80 の **交換命令 / ブロック転送命令 / ブロックサーチ命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **交換命令 / ブロック転送命令 / ブロックサーチ命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| EX DE, HL | DE ⇄ HL | - - - - - - | EB | 1 | 4 | 4 | - |
| EX AF, AF' | AF ⇄ AF' | - - - - - - | 08 | 1 | 4 | 4 | - |
| EXX | (BC ⇄ BC'), (DE ⇄ DE'), (HL ⇄ HL') | - - - - - - | D9 | 1 | 4 | 4 | - |
| EX (SP), HL | HL ⇄ (SP) | - - - - - - | E3 | 1 | 19 | 19 | スタックとの交換 |
| EX (SP), IX | IX ⇄ (SP) | - - - - - - | (DD) E3 | 2 | 23 | 23 | - |
| EX (SP), IY | IY ⇄ (SP) | - - - - - - | (FD) E3 | 2 | 23 | 23 | - |
| LDI | (DE) ← (HL), DE++, HL++, BC-- | - - 0 P 0 0 | (ED) A0 | 2 | 16 | 16 | BC=0 の時 P/V=0、BC≠0 の時 P/V=1 |
| LDIR | LDI を BC=0 になるまで繰り返す | - - 0 0 0 0 | (ED) B0 | 2 | 21 / 16 | 21 / 16 | BC≠0 の時 繰り返し |
| LDD | (DE) ← (HL), DE--, HL--, BC-- | - - 0 P 0 0 | (ED) A8 | 2 | 16 | 16 | - |
| LDDR | LDD を BC=0 になるまで繰り返す | - - 0 0 0 0 | (ED) B8 | 2 | 21 / 16 | 21 / 16 | BC≠0 の時 繰り返し |
| CPI | A - (HL), HL++, BC-- | ↑ ↓ ↑ 1 ↑ ↑ | (ED) A1 | 2 | 16 | 16 | A=(HL) なら Z=1, A≠(HL) なら Z=0 |
| CPIR | CPI を A=(HL) または BC=0 になるまで繰り返し | ↑ ↓ ↑ 1 ↑ ↑ | (ED) B1 | 2 | 21 / 16 | 21 / 16 | BC≠0 の時 繰り返し |
| CPD | A - (HL), HL--, BC-- | ↑ ↓ ↑ 1 ↑ ↑ | (ED) A9 | 2 | 16 | 16 | - |
| CPDR | CPD を A=(HL) または BC=0 になるまで繰り返し | ↑ ↓ ↑ 1 ↑ ↑ | (ED) B9 | 2 | 21 / 16 | 21 / 16 | BC≠0 の時 繰り返し |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `↑` = 変化あり (セット)
- `↓` = 変化あり (リセット)
- `-` = 無変化

---

## **📌 補足情報**
- `EX` 命令は **レジスタやメモリとの交換**
- `LDI` / `LDD` は **(DE) に (HL) の内容を転送し、HL, DE をインクリメント/デクリメント**
- `LDIR` / `LDDR` は **転送を BC=0 になるまで繰り返す**
- `CPI` / `CPD` は **A - (HL) を行い、HL をインクリメント/デクリメント**
- `CPIR` / `CPDR` は **比較を BC=0 または A=(HL) になるまで繰り返す**

---

## **📌 例: 命令のオペコード**
**LDIR の場合**
```assembly
LDIR  ; (DE) ← (HL), HL++, DE++, BC-- を BC=0 まで繰り返す





# Z80 ビット操作命令

このドキュメントは Z80 の **ビット操作命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **ビット操作命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| BIT b, r | r の b ビットをテストし、Z フラグに格納 | × 1 × P/V 0 × | (CB) aabb brrr | 2 | 8 | 8 | `r` = `B, C, D, E, H, L, A` |
| BIT b, (HL) | (HL) の b ビットをテストし、Z フラグに格納 | × 1 × P/V 0 × | (CB) aabb b110 | 2 | 12 | 12 | メモリ間接 |
| BIT b, (IX+d) | (IX+d) の b ビットをテストし、Z フラグに格納 | × 1 × P/V 0 × | (DD CB) aabb b110 | 4 | 20 | 20 | インデックス付き |
| BIT b, (IY+d) | (IY+d) の b ビットをテストし、Z フラグに格納 | × 1 × P/V 0 × | (FD CB) aabb b110 | 4 | 20 | 20 | インデックス付き |
| SET b, r | r の b ビットを 1 にセット | - - - - - - | (CB) 11bb brrr | 2 | 8 | 8 | - |
| SET b, (HL) | (HL) の b ビットを 1 にセット | - - - - - - | (CB) 11bb b110 | 2 | 15 | 15 | メモリ間接 |
| SET b, (IX+d) | (IX+d) の b ビットを 1 にセット | - - - - - - | (DD CB) 11bb b110 | 4 | 23 | 23 | インデックス付き |
| SET b, (IY+d) | (IY+d) の b ビットを 1 にセット | - - - - - - | (FD CB) 11bb b110 | 4 | 23 | 23 | インデックス付き |
| RES b, r | r の b ビットを 0 にリセット | - - - - - - | (CB) 10bb brrr | 2 | 8 | 8 | - |
| RES b, (HL) | (HL) の b ビットを 0 にリセット | - - - - - - | (CB) 10bb b110 | 2 | 15 | 15 | メモリ間接 |
| RES b, (IX+d) | (IX+d) の b ビットを 0 にリセット | - - - - - - | (DD CB) 10bb b110 | 4 | 23 | 23 | インデックス付き |
| RES b, (IY+d) | (IY+d) の b ビットを 0 にリセット | - - - - - - | (FD CB) 10bb b110 | 4 | 23 | 23 | インデックス付き |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `×` = 無変化
- `1` = セット
- `0` = リセット

---

## **📌 オペコードの構造**
| `bb` の値 | ビット位置 |
|------------|------------|
| `000` | ビット 0 |
| `001` | ビット 1 |
| `010` | ビット 2 |
| `011` | ビット 3 |
| `100` | ビット 4 |
| `101` | ビット 5 |
| `110` | ビット 6 |
| `111` | ビット 7 |

| `rrr` の値 | レジスタ |
|------------|---------|
| `000` | `B` |
| `001` | `C` |
| `010` | `D` |
| `011` | `E` |
| `100` | `H` |
| `101` | `L` |
| `111` | `A` |

---

## **📌 補足情報**
- `BIT b, r` は **レジスタ r の b ビットをテストし、Z フラグに反映**
- `SET b, r` は **レジスタ r の b ビットを 1 にセット**
- `RES b, r` は **レジスタ r の b ビットを 0 にリセット**
- `(HL)`, `(IX+d)`, `(IY+d)` を使う場合は **メモリアクセス**
- `CB` プレフィックスを使用する命令
- `(IX+d), (IY+d)` を使う場合は **(DD CB), (FD CB) プレフィックスが必要**

---

## **📌 例: 命令のオペコード**
**SET 3, A の場合**
```assembly
SET 3, A  ; A の 3 ビット目を 1 にセット





# Z80 ローテート・シフト命令

このドキュメントは Z80 の **ローテート・シフト命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **ローテート・シフト命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| RLCA | A を左ローテートし、7ビット目を Cy と 0ビット目にセット | 0 0 0 0 0 ↑ | 07 | 1 | 4 | 4 | - |
| RLA | A を左ローテートし、Cy を 0ビット目へ、7ビット目を Cy にセット | 0 0 0 0 0 ↑ | 17 | 1 | 4 | 4 | - |
| RRCA | A を右ローテートし、0ビット目を Cy と 7ビット目にセット | 0 0 0 0 0 ↑ | 0F | 1 | 4 | 4 | - |
| RRA | A を右ローテートし、Cy を 7ビット目へ、0ビット目を Cy にセット | 0 0 0 0 0 ↑ | 1F | 1 | 4 | 4 | - |
| RLC r | r を左ローテートし、7ビット目を 0ビット目に、はみ出た 7ビット目を Cy にセット | ↑ ↓ 0 P 0 ↑ | (CB) 00uu urrr | 2 | 8 | 8 | `r` = `B, C, D, E, H, L, A` |
| RLC (HL) | (HL) を左ローテートし、7ビット目を 0ビット目に、はみ出た 7ビット目を Cy にセット | ↑ ↓ 0 P 0 ↑ | (CB) 00uu u110 | 2 | 15 | 15 | メモリ間接 |
| RLC (IX+d) | (IX+d) を左ローテートし、7ビット目を 0ビット目に、はみ出た 7ビット目を Cy にセット | ↑ ↓ 0 P 0 ↑ | (DD CB) d 00uu u110 | 4 | 23 | 23 | インデックス付き |
| RLC (IY+d) | (IY+d) を左ローテートし、7ビット目を 0ビット目に、はみ出た 7ビット目を Cy にセット | ↑ ↓ 0 P 0 ↑ | (FD CB) d 00uu u110 | 4 | 23 | 23 | インデックス付き |
| RL m | m を左ローテートし、Cy を 0ビット目へ、7ビット目を Cy にセット | ↑ ↓ 0 P 0 ↑ | (CB) 00uu u010 | 2 | 15 | 15 | - |
| RRC m | m を右ローテートし、0ビット目を 7ビット目に、はみ出た 0ビット目を Cy にセット | ↑ ↓ 0 P 0 ↑ | (CB) 00uu u001 | 2 | 15 | 15 | - |
| RR m | m を右ローテートし、Cy を 7ビット目へ、0ビット目を Cy にセット | ↑ ↓ 0 P 0 ↑ | (CB) 00uu u011 | 2 | 15 | 15 | - |
| SLA m | m を左シフトし、7ビット目を Cy にセットし、0ビット目は 0 にする | ↑ ↓ 0 P 0 ↑ | (CB) 00uu u100 | 2 | 15 | 15 | - |
| SRA m | m を右シフトし、0ビット目を Cy にセットし、7ビット目は変化しない | ↑ ↓ 0 P 0 ↑ | (CB) 00uu u101 | 2 | 15 | 15 | - |
| SRL m | m を右シフトし、0ビット目を Cy にセットし、7ビット目は 0 になる | ↑ ↓ 0 P 0 ↑ | (CB) 00uu u111 | 2 | 15 | 15 | - |
| RLD | A の下位 4 ビットを (HL) の下位 4 ビットへ、(HL) の上位 4 ビットを A の下位 4 ビットへ、(HL) の下位 4 ビットを (HL) の上位 4 ビットへセット | ↑ ↓ 0 P 0 - | (ED) 6F | 2 | 18 | 18 | - |
| RRD | A の下位 4 ビットを (HL) の上位 4 ビットへ、(HL) の下位 4 ビットを A の下位 4 ビットへ、(HL) の上位 4 ビットを (HL) の下位 4 ビットへセット | ↑ ↓ 0 P 0 - | (ED) 67 | 2 | 18 | 18 | - |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `↑` = 変化あり (セット)
- `↓` = 変化あり (リセット)
- `0` = クリア
- `-` = 無変化

---

## **📌 補足情報**
- `RLC` / `RL` は **左ローテート**
- `RRC` / `RR` は **右ローテート**
- `SLA` は **左シフト、0ビット目を 0 にする**
- `SRA` は **右シフト、7ビット目は変化しない**
- `SRL` は **右シフト、7ビット目を 0 にする**
- `RLD` / `RRD` は **(HL) の上位/下位 4 ビットと A の下位 4 ビットを交換**
- `(IX+d), (IY+d)` を使う場合は **(DD CB), (FD CB) プレフィックスが必要**

---

## **📌 例: 命令のオペコード**
**RLD の場合**
```assembly
RLD  ; A の下位4ビットと (HL) の下位4ビットを交換し、(HL) のビットを回転





# Z80 無条件ジャンプ命令・条件付きジャンプ命令

このドキュメントは Z80 の **無条件ジャンプ命令・条件付きジャンプ命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **無条件ジャンプ命令・条件付きジャンプ命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| JP nn | PC ← nn へ無条件ジャンプ | - - - - - - | C3 nn nn | 3 | 10 | 10 | - |
| JP cc, nn | フラグ条件 `cc` が真なら PC ← nn へジャンプ | - - - - - - | 11cc c010 | 3 | 10 | 10 | `cc` = `NZ, Z, NC, C, PO, PE, P, M` |
| JR e | PC ← PC+e へ相対ジャンプ | - - - - - - | 18 e | 2 | 12 | 12 | `e` は -126 〜 +129 の 8ビット相対値 |
| JR ff, e | フラグ条件 `ff` が真なら PC ← PC+e へ相対ジャンプ | - - - - - - | 00ff f000 e | 2 | 12 / 7 | 12 / 7 | `ff` = `NZ, Z, NC, C` |
| DJNZ e | B ← B-1, B≠0 なら PC ← PC+e へジャンプ | - - - - - - | 10 e | 2 | 13 / 8 | 13 / 8 | B=0 なら次の命令実行 |
| JP (HL) | PC ← HL へジャンプ | - - - - - - | E9 | 1 | 4 | 4 | - |
| JP (IX) | PC ← IX へジャンプ | - - - - - - | (DD) E9 | 2 | 8 | 8 | - |
| JP (IY) | PC ← IY へジャンプ | - - - - - - | (FD) E9 | 2 | 8 | 8 | - |

---

## **📌 フラグ条件**
| `cc` の値 | 条件 | 意味 |
|------------|------------|------------|
| `000` | NZ | Z=0 (ゼロでない) |
| `001` | Z | Z=1 (ゼロ) |
| `010` | NC | C=0 (キャリーなし) |
| `011` | C | C=1 (キャリーあり) |
| `100` | PO | P/V=0 (パリティ奇数) |
| `101` | PE | P/V=1 (パリティ偶数) |
| `110` | P | S=0 (正) |
| `111` | M | S=1 (負) |

| `ff` の値 | 条件 | 意味 |
|------------|------------|------------|
| `00` | NZ | Z=0 (ゼロでない) |
| `01` | Z | Z=1 (ゼロ) |
| `10` | NC | C=0 (キャリーなし) |
| `11` | C | C=1 (キャリーあり) |

---

## **📌 補足情報**
- `JP nn` は **16ビットアドレス (nn) へ無条件ジャンプ**
- `JP cc, nn` は **フラグの状態を判定して条件付きジャンプ**
- `JR e` は **現在の PC から相対ジャンプ (-126 〜 +129 の範囲)**
- `JR ff, e` は **条件付き相対ジャンプ**
- `DJNZ e` は **B をデクリメントし、0 でなければジャンプ**
- `JP (HL), JP (IX), JP (IY)` は **HL, IX, IY の値へジャンプ**

---

## **📌 例: 命令のオペコード**
**JP Z, 4000h の場合**
```assembly
JP Z, 4000h  ; Z フラグがセットされているとき、アドレス 4000h へジャンプ





# Z80 コール命令・リターン命令

このドキュメントは Z80 の **コール命令・リターン命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **コール命令・リターン命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| CALL nn | (SP-2) ← PC, PC ← nn | - - - - - - | CD nn nn | 3 | 17 | 17 | サブルーチン呼び出し |
| CALL cc, nn | フラグ条件 `cc` が真なら (SP-2) ← PC, PC ← nn | - - - - - - | 11cc c100 nn nn | 3 | 17 / 10 | 17 / 10 | `cc` = `NZ, Z, NC, C, PO, PE, P, M` |
| RET | PC ← (SP), SP ← SP+2 | - - - - - - | C9 | 1 | 10 | 10 | サブルーチンからのリターン |
| RET cc | フラグ条件 `cc` が真なら PC ← (SP), SP ← SP+2 | - - - - - - | 11cc c000 | 1 | 11 / 5 | 11 / 5 | `cc` = `NZ, Z, NC, C, PO, PE, P, M` |
| RETI | 割込み処理からのリターン | - - - - - - | (ED) 4D | 2 | 14 | 14 | マスク可能 (INT) 割込み用 |
| RETN | ノンマスカブル割込み (NMI) からのリターン | - - - - - - | (ED) 45 | 2 | 14 | 14 | NMI 用 |
| RST p | (SP-2) ← PC, PC ← p | - - - - - - | 11pp p111 | 1 | 11 | 11 | `p` = `00h, 08h, 10h, 18h, 20h, 28h, 30h, 38h` |

---

## **📌 フラグ条件**
| `cc` の値 | 条件 | 意味 |
|------------|------------|------------|
| `000` | NZ | Z=0 (ゼロでない) |
| `001` | Z | Z=1 (ゼロ) |
| `010` | NC | C=0 (キャリーなし) |
| `011` | C | C=1 (キャリーあり) |
| `100` | PO | P/V=0 (パリティ奇数) |
| `101` | PE | P/V=1 (パリティ偶数) |
| `110` | P | S=0 (正) |
| `111` | M | S=1 (負) |

| `p` の値 | 飛び先アドレス |
|------------|------------|
| `000` | `00h` |
| `001` | `08h` |
| `010` | `10h` |
| `011` | `18h` |
| `100` | `20h` |
| `101` | `28h` |
| `110` | `30h` |
| `111` | `38h` |

---

## **📌 補足情報**
- `CALL nn` は **PC をスタックに保存し、nn へジャンプ**
- `CALL cc, nn` は **フラグの状態を判定して条件付きジャンプ**
- `RET` は **スタックから PC を復元し、リターン**
- `RET cc` は **条件付きリターン**
- `RETI` は **割込み処理からのリターン (INT)**
- `RETN` は **NMI 割込みからのリターン**
- `RST p` は **CALL p の短縮版。固定アドレスにジャンプ**

---

## **📌 例: 命令のオペコード**
**RST 38h の場合**
```assembly
RST 38h  ; (SP-2) ← PC, PC ← 38h





# Z80 入出力命令

このドキュメントは Z80 の **入出力命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **入出力命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| IN A, (n) | A ← ポート `n` の入力 | - - - - - - | DB n | 2 | 11 | 11 | `0 ≤ n ≤ 255` |
| IN r, (C) | r ← ポート `C` の入力 | ↑ ↓ 0 P 0 0 | (ED) 01rr r000 | 2 | 12 | 12 | `r` = `A, B, C, D, E, H, L` |
| INI | (HL) ← ポート `C`、B--、HL++ | ↑ × × × 1 × | (ED) A2 | 2 | 16 | 16 | - |
| INIR | `INI` を B=0 になるまで繰り返す | ↑ × × × 1 × | (ED) B2 | 2 | 21 / 16 | 21 / 16 | B≠0 の時 繰り返し |
| IND | (HL) ← ポート `C`、B--、HL-- | ↑ × × × 1 × | (ED) AA | 2 | 16 | 16 | - |
| INDR | `IND` を B=0 になるまで繰り返す | ↑ × × × 1 × | (ED) BA | 2 | 21 / 16 | 21 / 16 | B≠0 の時 繰り返し |
| OUT (n), A | ポート `n` ← A | - - - - - - | D3 n | 2 | 11 | 11 | `0 ≤ n ≤ 255` |
| OUT (C), r | ポート `C` ← r | - - - - - - | (ED) 01rr r001 | 2 | 12 | 12 | `r` = `A, B, C, D, E, H, L` |
| OUTI | ポート `C` ← (HL)、B--、HL++ | ↑ × × × 1 × | (ED) A3 | 2 | 16 | 16 | - |
| OTIR | `OUTI` を B=0 になるまで繰り返す | ↑ × × × 1 × | (ED) B3 | 2 | 21 / 16 | 21 / 16 | B≠0 の時 繰り返し |
| OUTD | ポート `C` ← (HL)、B--、HL-- | ↑ × × × 1 × | (ED) AB | 2 | 16 | 16 | - |
| OTDR | `OUTD` を B=0 になるまで繰り返す | ↑ × × × 1 × | (ED) BB | 2 | 21 / 16 | 21 / 16 | B≠0 の時 繰り返し |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `↑` = 変化あり (セット)
- `↓` = 変化あり (リセット)
- `×` = 未定

---

## **📌 補足情報**
- `IN A, (n)` は **ポート `n` の値を A に読み込む**
- `IN r, (C)` は **ポート `C` の値を r に読み込む**
- `INI` / `IND` は **ポート `C` から HL の指すメモリへ転送**
- `INIR` / `INDR` は **B=0 になるまで `INI` / `IND` を繰り返す**
- `OUT (n), A` は **A の値をポート `n` に書き込む**
- `OUT (C), r` は **r の値をポート `C` に書き込む**
- `OUTI` / `OUTD` は **HL の指すメモリの値をポート `C` へ転送**
- `OTIR` / `OTDR` は **B=0 になるまで `OUTI` / `OUTD` を繰り返す**

---

## **📌 例: 命令のオペコード**
**OUT (10h), A の場合**
```assembly
OUT (10h), A  ; A の値をポート 10h に出力





# Z80 拡張・補足情報

このセクションでは、**Z80 命令セットの補足情報** をまとめています。  
**基本命令セットには含まれていないが、知っておくと便利な情報** を記載しています。

---

## 📝 **特殊な `LD` 命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| LD A, I | A ← I | * 0 * 0 * * | (ED) 57 | 2 | 9 | 9 | IFF2 の状態が P/V に入る |
| LD A, R | A ← R | * 0 * 0 * * | (ED) 5F | 2 | 9 | 9 | IFF2 の状態が P/V に入る |
| LD I, A | I ← A | - - - - - - | (ED) 47 | 2 | 9 | 9 | - |
| LD R, A | R ← A | - - - - - - | (ED) 4F | 2 | 9 | 9 | - |

### **📌 補足**
- `LD A, I` は **I レジスタ (割り込みベクタ) の値を A にロード**
- `LD A, R` は **R レジスタ (リフレッシュレジスタ) の値を A にロード**
- `LD I, A` は **A の値を I にロード**
- `LD R, A` は **A の値を R にロード**
- `IFF2` の状態が `P/V` フラグに反映されるため、割り込み制御と組み合わせて使われる

---

## 📝 **Z280 拡張命令: `MUL`**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| MUL D, E | DE ← D × E | ↑ ↓ - P/V 0 ↑ | (ED) 30 | 2 | 17 | 17 | Z280 のみ |

### **📌 補足**
- Z80 には **乗算 (`MUL`) 命令は存在しない** が、Z280 などの **上位互換 CPU** では `MUL` が追加されている
- `MUL D, E` は **D × E の結果を `DE` レジスタに格納**
- `P/V` フラグには **オーバーフロー情報がセットされる**

---

## 📝 **Z280/R800 拡張命令: `SLL`**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| SLL r | r を左シフトし、0ビット目に 1 をセット | ↑ ↓ 0 P 0 ↑ | (CB) 11000rrr | 2 | 8 | 8 | `r` = `B, C, D, E, H, L, A` |
| SLL (HL) | (HL) を左シフトし、0ビット目に 1 をセット | ↑ ↓ 0 P 0 ↑ | (CB) 11000 110 | 2 | 15 | 15 | メモリ間接 |

### **📌 補足**
- Z80 **標準の SLA 命令と異なり、0ビット目に `1` をセットする**
- Z80 には存在しないが、**Z280 や R800 などの拡張 CPU では実装されている**
- `SLA` と混同しないよう注意 (`SLA` は 0ビット目に `0` をセット)

---

## 📝 **RST 命令の飛び先アドレス一覧**
| 命令 | 飛び先アドレス | 機能 |
|------|------------|------|
| RST 00h | `0000h` | ベクター割込み (INT 0) |
| RST 08h | `0008h` | - |
| RST 10h | `0010h` | - |
| RST 18h | `0018h` | - |
| RST 20h | `0020h` | - |
| RST 28h | `0028h` | - |
| RST 30h | `0030h` | - |
| RST 38h | `0038h` | 通常の割込みベクター |

### **📌 補足**
- `RST p` は `CALL p` の短縮版 (1バイトで呼び出し可能)
- `RST 38h` は **通常の割込みハンドラ** として使われることが多い
- `0000h` には **電源投入時のリセットベクタ** を配置することが一般的
- 各 `RST` アドレスには、簡易ハンドラや割込み処理を配置可能

---

## **📌 例: 命令のオペコード**
```assembly
LD A, I   ; A ← I レジスタの値をロード
MUL D, E  ; Z280: DE ← D × E
SLL A     ; Z280/R800: A を左シフトし、0ビット目に 1 をセット
RST 38h   ; 割込み発生時に PC を 38h にジャンプ


# Z80 8ビット転送命令

このドキュメントは Z80 の **8ビット転送命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **8ビット転送命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| LD r, r' | r ← r' | - - - - - - | 01rrr rrr | 1 | 4 | 4 | レジスタ間転送 |
| LD r, n | r ← n | - - - - - - | 00rrr 110 | 2 | 7 | 7 | 即値ロード |
| LD r, (HL) | r ← (HL) | - - - - - - | 01rrr 110 | 1 | 7 | 7 | メモリアクセス |
| LD r, (IX+d) | r ← (IX+d) | - - - - - - | (DD) 01rrr 110 | 3 | 19 | 19 | インデックス付き |
| LD r, (IY+d) | r ← (IY+d) | - - - - - - | (FD) 01rrr 110 | 3 | 19 | 19 | インデックス付き |
| LD (HL), r | (HL) ← r | - - - - - - | 011110rrr | 1 | 7 | 7 | メモリアクセス |
| LD (IX+d), r | (IX+d) ← r | - - - - - - | (DD) 01110rrr | 3 | 19 | 19 | インデックス付き |
| LD (IY+d), r | (IY+d) ← r | - - - - - - | (FD) 01110rrr | 3 | 19 | 19 | インデックス付き |
| LD (HL), n | (HL) ← n | - - - - - - | 36 nn | 2 | 10 | 10 | 即値 |
| LD (IX+d), n | (IX+d) ← n | - - - - - - | (DD) 36 nn | 4 | 19 | 19 | インデックス即値 |
| LD (IY+d), n | (IY+d) ← n | - - - - - - | (FD) 36 nn | 4 | 19 | 19 | インデックス即値 |
| LD A, (BC) | A ← (BC) | - - - - - - | 0A | 1 | 7 | 7 | メモリ間接 |
| LD A, (DE) | A ← (DE) | - - - - - - | 1A | 1 | 7 | 7 | メモリ間接 |
| LD A, (nn) | A ← (nn) | - - - - - - | 3A nn nn | 3 | 13 | 13 | メモリ間接 |
| LD (BC), A | (BC) ← A | - - - - - - | 02 | 1 | 7 | 7 | メモリ間接 |
| LD (DE), A | (DE) ← A | - - - - - - | 12 | 1 | 7 | 7 | メモリ間接 |
| LD (nn), A | (nn) ← A | - - - - - - | 32 nn nn | 3 | 13 | 13 | メモリ間接 |
| LD A, I | A ← I | * 0 * 0 * * | ED 57 | 2 | 9 | 9 | IFF2 の状態が P/V に入る |
| LD A, R | A ← R | * 0 * 0 * * | ED 5F | 2 | 9 | 9 | IFF2 の状態が P/V に入る |
| LD I, A | I ← A | - - - - - - | ED 47 | 2 | 9 | 9 | - |
| LD R, A | R ← A | - - - - - - | ED 4F | 2 | 9 | 9 | - |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `-` = 無変化
- `*` = 変化あり
- `0` = リセット
- `1` = セット

---

## **📌 レジスタ対応表**
| `rrr` の値 | レジスタ |
|------------|---------|
| `000` | `B` |
| `001` | `C` |
| `010` | `D` |
| `011` | `E` |
| `100` | `H` |
| `101` | `L` |
| `110` | `(HL)` |
| `111` | `A` |

---

## **📌 補足情報**
- `(IX+d)` や `(IY+d)` は **IX, IY レジスタを基準としたオフセットメモリアクセス**
- `n` は **8ビット即値**
- `nn` は **16ビット即値アドレス**
- `IFF2` の状態が `P/V` フラグに影響する特殊命令あり

---

## **📌 例: 命令のオペコード**
**LD A, 32 の場合**
```assembly
LD A, 32  ; A ← 32 をロード





# Z80 16ビット・ロード命令

このドキュメントは Z80 の **16ビット・ロード命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **16ビット・ロード命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| LD dd, nn | dd ← nn | - - - - - - | 00dd 0001 | 3 | 10 | 10 | `dd` = `BC`, `DE`, `HL`, `SP` |
| LD IX, nn | IX ← nn | - - - - - - | (DD) 21 | 4 | 14 | 14 | - |
| LD IY, nn | IY ← nn | - - - - - - | (FD) 21 | 4 | 14 | 14 | - |
| LD HL, (nn) | HL ← (nn) | - - - - - - | 2A nn nn | 3 | 16 | 16 | `nn` はアドレス |
| LD dd, (nn) | dd ← (nn) | - - - - - - | (ED) 01dd 1011 | 4 | 20 | 20 | `dd` = `BC`, `DE`, `HL`, `SP` |
| LD IX, (nn) | IX ← (nn) | - - - - - - | (DD) 2A | 4 | 20 | 20 | `nn` はアドレス |
| LD IY, (nn) | IY ← (nn) | - - - - - - | (FD) 2A | 4 | 20 | 20 | `nn` はアドレス |
| LD (nn), HL | (nn) ← HL | - - - - - - | 22 nn nn | 3 | 16 | 16 | `nn` はアドレス |
| LD (nn), dd | (nn) ← dd | - - - - - - | (ED) 01dd 0011 | 4 | 20 | 20 | `dd` = `BC`, `DE`, `HL`, `SP` |
| LD (nn), IX | (nn) ← IX | - - - - - - | (DD) 22 | 4 | 20 | 20 | `nn` はアドレス |
| LD (nn), IY | (nn) ← IY | - - - - - - | (FD) 22 | 4 | 20 | 20 | `nn` はアドレス |
| LD SP, HL | SP ← HL | - - - - - - | F9 | 1 | 6 | 6 | - |
| LD SP, IX | SP ← IX | - - - - - - | (DD) F9 | 2 | 10 | 10 | - |
| LD SP, IY | SP ← IY | - - - - - - | (FD) F9 | 2 | 10 | 10 | - |
| PUSH qq | (SP-2) ← qq | - - - - - - | 11qq 0101 | 1 | 11 | 11 | `qq` = `BC`, `DE`, `HL`, `AF` |
| PUSH IX | (SP-2) ← IX | - - - - - - | (DD) E5 | 2 | 15 | 15 | - |
| PUSH IY | (SP-2) ← IY | - - - - - - | (FD) E5 | 2 | 15 | 15 | - |
| POP qq | qq ← (SP) | - - - - - - | 11qq 0001 | 1 | 10 | 10 | `qq` = `BC`, `DE`, `HL`, `AF` |
| POP IX | IX ← (SP) | - - - - - - | (DD) E1 | 2 | 14 | 14 | - |
| POP IY | IY ← (SP) | - - - - - - | (FD) E1 | 2 | 14 | 14 | - |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `-` = 無変化

---

## **📌 レジスタ対応表**
| `dd` の値 | レジスタ | `qq` の値 | レジスタ |
|------------|---------|------------|---------|
| `00` | `BC` | `00` | `BC` |
| `01` | `DE` | `01` | `DE` |
| `10` | `HL` | `10` | `HL` |
| `11` | `SP` | `11` | `AF` |

---

## **📌 補足情報**
- `(nn)` は **16ビットアドレスを指すメモリ間接ロード**
- `dd` は **16ビットレジスタ (`BC`, `DE`, `HL`, `SP`)**
- `qq` は **PUSH/POP に対応するレジスタ (`BC`, `DE`, `HL`, `AF`)**
- `PUSH` は **スタックポインタ (SP) を 2 減算**
- `POP` は **スタックポインタ (SP) を 2 加算**
- `POP AF` の場合、**F レジスタの内容も復元**

---

## **📌 例: 命令のオペコード**
**LD HL, (4000h) の場合**
```assembly
LD HL, (4000h)  ; HL ← メモリ 4000h の内容をロード





# Z80 16ビット・ロード命令

このドキュメントは Z80 の **16ビット・ロード命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **16ビット・ロード命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| LD dd, nn | dd ← nn | - - - - - - | 00dd 0001 | 3 | 10 | 10 | `dd` = `BC`, `DE`, `HL`, `SP` |
| LD IX, nn | IX ← nn | - - - - - - | (DD) 21 | 4 | 14 | 14 | - |
| LD IY, nn | IY ← nn | - - - - - - | (FD) 21 | 4 | 14 | 14 | - |
| LD HL, (nn) | HL ← (nn) | - - - - - - | 2A nn nn | 3 | 16 | 16 | `nn` はアドレス |
| LD dd, (nn) | dd ← (nn) | - - - - - - | (ED) 01dd 1011 | 4 | 20 | 20 | `dd` = `BC`, `DE`, `HL`, `SP` |
| LD IX, (nn) | IX ← (nn) | - - - - - - | (DD) 2A | 4 | 20 | 20 | `nn` はアドレス |
| LD IY, (nn) | IY ← (nn) | - - - - - - | (FD) 2A | 4 | 20 | 20 | `nn` はアドレス |
| LD (nn), HL | (nn) ← HL | - - - - - - | 22 nn nn | 3 | 16 | 16 | `nn` はアドレス |
| LD (nn), dd | (nn) ← dd | - - - - - - | (ED) 01dd 0011 | 4 | 20 | 20 | `dd` = `BC`, `DE`, `HL`, `SP` |
| LD (nn), IX | (nn) ← IX | - - - - - - | (DD) 22 | 4 | 20 | 20 | `nn` はアドレス |
| LD (nn), IY | (nn) ← IY | - - - - - - | (FD) 22 | 4 | 20 | 20 | `nn` はアドレス |
| LD SP, HL | SP ← HL | - - - - - - | F9 | 1 | 6 | 6 | - |
| LD SP, IX | SP ← IX | - - - - - - | (DD) F9 | 2 | 10 | 10 | - |
| LD SP, IY | SP ← IY | - - - - - - | (FD) F9 | 2 | 10 | 10 | - |
| PUSH qq | (SP-2) ← qq | - - - - - - | 11qq 0101 | 1 | 11 | 11 | `qq` = `BC`, `DE`, `HL`, `AF` |
| PUSH IX | (SP-2) ← IX | - - - - - - | (DD) E5 | 2 | 15 | 15 | - |
| PUSH IY | (SP-2) ← IY | - - - - - - | (FD) E5 | 2 | 15 | 15 | - |
| POP qq | qq ← (SP) | - - - - - - | 11qq 0001 | 1 | 10 | 10 | `qq` = `BC`, `DE`, `HL`, `AF` |
| POP IX | IX ← (SP) | - - - - - - | (DD) E1 | 2 | 14 | 14 | - |
| POP IY | IY ← (SP) | - - - - - - | (FD) E1 | 2 | 14 | 14 | - |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `-` = 無変化

---

## **📌 レジスタ対応表**
| `dd` の値 | レジスタ | `qq` の値 | レジスタ |
|------------|---------|------------|---------|
| `00` | `BC` | `00` | `BC` |
| `01` | `DE` | `01` | `DE` |
| `10` | `HL` | `10` | `HL` |
| `11` | `SP` | `11` | `AF` |

---

## **📌 補足情報**
- `(nn)` は **16ビットアドレスを指すメモリ間接ロード**
- `dd` は **16ビットレジスタ (`BC`, `DE`, `HL`, `SP`)**
- `qq` は **PUSH/POP に対応するレジスタ (`BC`, `DE`, `HL`, `AF`)**
- `PUSH` は **スタックポインタ (SP) を 2 減算**
- `POP` は **スタックポインタ (SP) を 2 加算**
- `POP AF` の場合、**F レジスタの内容も復元**

---

## **📌 例: 命令のオペコード**
**LD HL, (4000h) の場合**
```assembly
LD HL, (4000h)  ; HL ← メモリ 4000h の内容をロード





# Z80 8ビット算術論理演算命令

このドキュメントは Z80 の **8ビット算術論理演算命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **8ビット算術論理演算命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| ADD A, r | A ← A + r | ↑↓1↓↓0↓ | 10tt trrr | 1 | 4 | 4 | `r` は 8ビットレジスタ |
| ADD A, n | A ← A + n | ↑↓1↓↓0↓ | 110tt 110 | 2 | 7 | 7 | 即値 |
| ADD A, (HL) | A ← A + (HL) | ↑↓1↓↓0↓ | 10tt t110 | 1 | 7 | 7 | メモリ間接 |
| ADD A, (IX+d) | A ← A + (IX+d) | ↑↓1↓↓0↓ | (DD) 10tt t110 | 3 | 19 | 19 | インデックス付き |
| ADD A, (IY+d) | A ← A + (IY+d) | ↑↓1↓↓0↓ | (FD) 10tt t110 | 3 | 19 | 19 | インデックス付き |
| ADC A, s | A ← A + s + Cy | ↑↓1↓↓0↑ | 11tt t001 | 1 | 4 | 4 | `s` は `r, n, (HL), (IX+d), (IY+d)` |
| SUB A, s | A ← A - s | ↑↓1↓↓1↓ | 11tt t010 | 1 | 4 | 4 | - |
| SBC A, s | A ← A - s - Cy | ↑↓1↓↓1↑ | 11tt t011 | 1 | 4 | 4 | - |
| AND s | A ← A AND s | ↑↓1↑↓0↓ | 11tt t100 | 1 | 4 | 4 | - |
| OR s | A ← A OR s | ↑↓1↓↓0↓ | 11tt t110 | 1 | 4 | 4 | - |
| XOR s | A ← A XOR s | ↑↓1↓↓0↓ | 11tt t101 | 1 | 4 | 4 | - |
| CP s | A - s の結果をフラグに設定 | ↑↓1↓↓1↑ | 11tt t111 | 1 | 4 | 4 | 比較演算 |
| INC r | r ← r + 1 | ↑↓1↑↓0↓ | 00rrr 100 | 1 | 4 | 4 | `r` は 8ビットレジスタ |
| INC (HL) | (HL) ← (HL) + 1 | ↑↓1↑↓0↓ | 0011 0100 | 1 | 11 | 11 | メモリ間接 |
| INC (IX+d) | (IX+d) ← (IX+d) + 1 | ↑↓1↑↓0↓ | (DD) 00 11 0100 | 3 | 23 | 23 | インデックス付き |
| INC (IY+d) | (IY+d) ← (IY+d) + 1 | ↑↓1↑↓0↓ | (FD) 00 11 0100 | 3 | 23 | 23 | インデックス付き |
| DEC m | m ← m - 1 | ↑↓1↑↓1↓ | 00rrr 101 | 1 | 4 | 4 | `m` は `r, (HL), (IX+d), (IY+d)` |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `↑↓` = 変化あり
- `1` = セット
- `0` = リセット

---

## **📌 オペコードの構造**
| `ttt` の値 | 命令 | `s` の値 | 説明 |
|------------|------|------------|------|
| `000` | ADD | `r, n, (HL), (IX+d), (IY+d)` | A + s |
| `001` | ADC | `r, n, (HL), (IX+d), (IY+d)` | A + s + Cy |
| `010` | SUB | `r, n, (HL), (IX+d), (IY+d)` | A - s |
| `011` | SBC | `r, n, (HL), (IX+d), (IY+d)` | A - s - Cy |
| `100` | AND | `r, n, (HL), (IX+d), (IY+d)` | A AND s |
| `101` | XOR | `r, n, (HL), (IX+d), (IY+d)` | A XOR s |
| `110` | OR | `r, n, (HL), (IX+d), (IY+d)` | A OR s |
| `111` | CP | `r, n, (HL), (IX+d), (IY+d)` | A - s の結果をフラグに設定 |

---

## **📌 補足情報**
- `(IX+d), (IY+d)` は **IX, IY レジスタを基準としたオフセットメモリアクセス**
- `n` は **8ビット即値**
- `r` は **8ビットレジスタ (`B, C, D, E, H, L, A`)**
- `m` は **`r, (HL), (IX+d), (IY+d)` に適用可能**

---

## **📌 例: 命令のオペコード**
**ADD A, 42 の場合**
```assembly
ADD A, 42  ; A ← A + 42





# Z80 16ビット算術演算命令

このドキュメントは Z80 の **16ビット算術演算命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **16ビット算術演算命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| ADD HL, ss | HL ← HL + ss | - × - × 0 ↑ | 00ss 1001 | 1 | 11 | 11 | `ss` = `BC`, `DE`, `HL`, `SP` |
| ADC HL, ss | HL ← HL + ss + Cy | ↑ ↓ × ↓ 0 ↑ | (ED) 01ss 1010 | 2 | 15 | 15 | - |
| SBC HL, ss | HL ← HL - ss - Cy | ↑ ↓ × ↓ 1 ↑ | (ED) 01ss 0010 | 2 | 15 | 15 | - |
| ADD IX, pp | IX ← IX + pp | - × - × 0 ↑ | (DD) 00pp 1001 | 2 | 15 | 15 | `pp` = `BC`, `DE`, `IX`, `SP` |
| ADD IY, rr | IY ← IY + rr | - × - × 0 ↑ | (FD) 00rr 1001 | 2 | 15 | 15 | `rr` = `BC`, `DE`, `IY`, `SP` |
| INC ss | ss ← ss + 1 | - × - × 0 - | 00ss 0011 | 1 | 6 | 6 | `ss` = `BC`, `DE`, `HL`, `SP` |
| INC IX | IX ← IX + 1 | - - - - - - | (DD) 23 | 2 | 10 | 10 | - |
| INC IY | IY ← IY + 1 | - - - - - - | (FD) 23 | 2 | 10 | 10 | - |
| DEC ss | ss ← ss - 1 | - - - - - - | 00ss 1011 | 1 | 6 | 6 | `ss` = `BC`, `DE`, `HL`, `SP` |
| DEC IX | IX ← IX - 1 | - - - - - - | (DD) 2B | 2 | 10 | 10 | - |
| DEC IY | IY ← IY - 1 | - - - - - - | (FD) 2B | 2 | 10 | 10 | - |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `×` = 未定
- `-` = 無変化
- `0` = リセット
- `1` = セット
- `↑` = 変化あり (セット)
- `↓` = 変化あり (リセット)

---

## **📌 オペコードの構造**
| `ss` / `pp` / `rr` の値 | レジスタ |
|------------|---------|
| `00` | `BC` |
| `01` | `DE` |
| `10` | `HL` または `IX/IY` |
| `11` | `SP` |

---

## **📌 補足情報**
- `ADD HL, ss` は **HL に 16ビットレジスタを加算**
- `ADC HL, ss` は **HL + ss + キャリーフラグ**
- `SBC HL, ss` は **HL - ss - キャリーフラグ**
- `INC/DEC` は **16ビットレジスタのインクリメント・デクリメント**
- `IX, IY` に対しても `ADD, INC, DEC` が可能

---

## **📌 例: 命令のオペコード**
**ADD HL, SP の場合**
```assembly
ADD HL, SP  ; HL ← HL + SP





# Z80 アキュムレータ (Aレジスタ) 操作命令 / MPU コントロール命令

このドキュメントは Z80 の **アキュムレータ (Aレジスタ) 操作命令** および **MPU コントロール命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **アキュムレータ (Aレジスタ) 操作命令 / MPU コントロール命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| DAA | 2進化10進補正 | ↑ ↓ ↑ P - ↑ | 27 | 1 | 4 | 4 | 加減算命令実行後に実行 |
| CPL | A ← A̅ | - - 1 1 1 - | 2F | 1 | 4 | 4 | A の補数 |
| NEG | A ← -A | ↑ ↓ ↑ V 1 ↑ | (ED) 44 | 2 | 8 | 8 | 2 の補数 |
| CCF | C ← 反転 | - - 0 P - ↑ | 3F | 1 | 4 | 4 | キャリーフラグの反転 |
| SCF | C ← 1 | - - 0 0 0 1 | 37 | 1 | 4 | 4 | キャリーセット |
| NOP | No Operation | - - - - - - | 00 | 1 | 4 | 4 | 何もしない |
| HALT | 待機状態 | - - - - - - | 76 | 1 | 4 | 4 | MPU ホルト状態 |
| DI | IFF ← 0 | - - - - - - | F3 | 1 | 4 | 4 | 割込み受付禁止 |
| EI | IFF ← 1 | - - - - - - | FB | 1 | 4 | 4 | 割込み受付許可 |
| IM 0 | 割込みモード 0 | - - - - - - | (ED) 46 | 2 | 8 | 8 | RST 命令を使用 |
| IM 1 | 割込みモード 1 | - - - - - - | (ED) 56 | 2 | 8 | 8 | 割込みモード 1 のセット |
| IM 2 | 割込みモード 2 | - - - - - - | (ED) 5E | 2 | 8 | 8 | ベクター割込み |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `↑` = 変化あり (セット)
- `↓` = 変化あり (リセット)
- `-` = 無変化

---

## **📌 補足情報**
- `DAA` は **BCD 計算時に使用する補正命令**
- `CPL` は **A レジスタのビット反転**
- `NEG` は **A を負の値にする (2 の補数)**
- `CCF` は **キャリーフラグの反転**
- `SCF` は **キャリーフラグを 1 にセット**
- `HALT` は **MPU を停止し、割り込み待ち状態にする**
- `DI` は **割込みを無効化**
- `EI` は **割込みを有効化**
- `IM 0` は **割込みモード 0 (RST命令で処理)**
- `IM 1` は **割込みモード 1 (割込み許可後、自動的に RST 38h へジャンプ)**
- `IM 2` は **割込みモード 2 (ベクター割込みを使用)**

---

## **📌 例: 命令のオペコード**
**DAA の場合**
```assembly
DAA  ; A レジスタの BCD 補正





# Z80 交換命令 / ブロック転送命令 / ブロックサーチ命令

このドキュメントは Z80 の **交換命令 / ブロック転送命令 / ブロックサーチ命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **交換命令 / ブロック転送命令 / ブロックサーチ命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| EX DE, HL | DE ⇄ HL | - - - - - - | EB | 1 | 4 | 4 | - |
| EX AF, AF' | AF ⇄ AF' | - - - - - - | 08 | 1 | 4 | 4 | - |
| EXX | (BC ⇄ BC'), (DE ⇄ DE'), (HL ⇄ HL') | - - - - - - | D9 | 1 | 4 | 4 | - |
| EX (SP), HL | HL ⇄ (SP) | - - - - - - | E3 | 1 | 19 | 19 | スタックとの交換 |
| EX (SP), IX | IX ⇄ (SP) | - - - - - - | (DD) E3 | 2 | 23 | 23 | - |
| EX (SP), IY | IY ⇄ (SP) | - - - - - - | (FD) E3 | 2 | 23 | 23 | - |
| LDI | (DE) ← (HL), DE++, HL++, BC-- | - - 0 P 0 0 | (ED) A0 | 2 | 16 | 16 | BC=0 の時 P/V=0、BC≠0 の時 P/V=1 |
| LDIR | LDI を BC=0 になるまで繰り返す | - - 0 0 0 0 | (ED) B0 | 2 | 21 / 16 | 21 / 16 | BC≠0 の時 繰り返し |
| LDD | (DE) ← (HL), DE--, HL--, BC-- | - - 0 P 0 0 | (ED) A8 | 2 | 16 | 16 | - |
| LDDR | LDD を BC=0 になるまで繰り返す | - - 0 0 0 0 | (ED) B8 | 2 | 21 / 16 | 21 / 16 | BC≠0 の時 繰り返し |
| CPI | A - (HL), HL++, BC-- | ↑ ↓ ↑ 1 ↑ ↑ | (ED) A1 | 2 | 16 | 16 | A=(HL) なら Z=1, A≠(HL) なら Z=0 |
| CPIR | CPI を A=(HL) または BC=0 になるまで繰り返し | ↑ ↓ ↑ 1 ↑ ↑ | (ED) B1 | 2 | 21 / 16 | 21 / 16 | BC≠0 の時 繰り返し |
| CPD | A - (HL), HL--, BC-- | ↑ ↓ ↑ 1 ↑ ↑ | (ED) A9 | 2 | 16 | 16 | - |
| CPDR | CPD を A=(HL) または BC=0 になるまで繰り返し | ↑ ↓ ↑ 1 ↑ ↑ | (ED) B9 | 2 | 21 / 16 | 21 / 16 | BC≠0 の時 繰り返し |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `↑` = 変化あり (セット)
- `↓` = 変化あり (リセット)
- `-` = 無変化

---

## **📌 補足情報**
- `EX` 命令は **レジスタやメモリとの交換**
- `LDI` / `LDD` は **(DE) に (HL) の内容を転送し、HL, DE をインクリメント/デクリメント**
- `LDIR` / `LDDR` は **転送を BC=0 になるまで繰り返す**
- `CPI` / `CPD` は **A - (HL) を行い、HL をインクリメント/デクリメント**
- `CPIR` / `CPDR` は **比較を BC=0 または A=(HL) になるまで繰り返す**

---

## **📌 例: 命令のオペコード**
**LDIR の場合**
```assembly
LDIR  ; (DE) ← (HL), HL++, DE++, BC-- を BC=0 まで繰り返す





# Z80 ビット操作命令

このドキュメントは Z80 の **ビット操作命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **ビット操作命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| BIT b, r | r の b ビットをテストし、Z フラグに格納 | × 1 × P/V 0 × | (CB) aabb brrr | 2 | 8 | 8 | `r` = `B, C, D, E, H, L, A` |
| BIT b, (HL) | (HL) の b ビットをテストし、Z フラグに格納 | × 1 × P/V 0 × | (CB) aabb b110 | 2 | 12 | 12 | メモリ間接 |
| BIT b, (IX+d) | (IX+d) の b ビットをテストし、Z フラグに格納 | × 1 × P/V 0 × | (DD CB) aabb b110 | 4 | 20 | 20 | インデックス付き |
| BIT b, (IY+d) | (IY+d) の b ビットをテストし、Z フラグに格納 | × 1 × P/V 0 × | (FD CB) aabb b110 | 4 | 20 | 20 | インデックス付き |
| SET b, r | r の b ビットを 1 にセット | - - - - - - | (CB) 11bb brrr | 2 | 8 | 8 | - |
| SET b, (HL) | (HL) の b ビットを 1 にセット | - - - - - - | (CB) 11bb b110 | 2 | 15 | 15 | メモリ間接 |
| SET b, (IX+d) | (IX+d) の b ビットを 1 にセット | - - - - - - | (DD CB) 11bb b110 | 4 | 23 | 23 | インデックス付き |
| SET b, (IY+d) | (IY+d) の b ビットを 1 にセット | - - - - - - | (FD CB) 11bb b110 | 4 | 23 | 23 | インデックス付き |
| RES b, r | r の b ビットを 0 にリセット | - - - - - - | (CB) 10bb brrr | 2 | 8 | 8 | - |
| RES b, (HL) | (HL) の b ビットを 0 にリセット | - - - - - - | (CB) 10bb b110 | 2 | 15 | 15 | メモリ間接 |
| RES b, (IX+d) | (IX+d) の b ビットを 0 にリセット | - - - - - - | (DD CB) 10bb b110 | 4 | 23 | 23 | インデックス付き |
| RES b, (IY+d) | (IY+d) の b ビットを 0 にリセット | - - - - - - | (FD CB) 10bb b110 | 4 | 23 | 23 | インデックス付き |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `×` = 無変化
- `1` = セット
- `0` = リセット

---

## **📌 オペコードの構造**
| `bb` の値 | ビット位置 |
|------------|------------|
| `000` | ビット 0 |
| `001` | ビット 1 |
| `010` | ビット 2 |
| `011` | ビット 3 |
| `100` | ビット 4 |
| `101` | ビット 5 |
| `110` | ビット 6 |
| `111` | ビット 7 |

| `rrr` の値 | レジスタ |
|------------|---------|
| `000` | `B` |
| `001` | `C` |
| `010` | `D` |
| `011` | `E` |
| `100` | `H` |
| `101` | `L` |
| `111` | `A` |

---

## **📌 補足情報**
- `BIT b, r` は **レジスタ r の b ビットをテストし、Z フラグに反映**
- `SET b, r` は **レジスタ r の b ビットを 1 にセット**
- `RES b, r` は **レジスタ r の b ビットを 0 にリセット**
- `(HL)`, `(IX+d)`, `(IY+d)` を使う場合は **メモリアクセス**
- `CB` プレフィックスを使用する命令
- `(IX+d), (IY+d)` を使う場合は **(DD CB), (FD CB) プレフィックスが必要**

---

## **📌 例: 命令のオペコード**
**SET 3, A の場合**
```assembly
SET 3, A  ; A の 3 ビット目を 1 にセット





# Z80 ローテート・シフト命令

このドキュメントは Z80 の **ローテート・シフト命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **ローテート・シフト命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| RLCA | A を左ローテートし、7ビット目を Cy と 0ビット目にセット | 0 0 0 0 0 ↑ | 07 | 1 | 4 | 4 | - |
| RLA | A を左ローテートし、Cy を 0ビット目へ、7ビット目を Cy にセット | 0 0 0 0 0 ↑ | 17 | 1 | 4 | 4 | - |
| RRCA | A を右ローテートし、0ビット目を Cy と 7ビット目にセット | 0 0 0 0 0 ↑ | 0F | 1 | 4 | 4 | - |
| RRA | A を右ローテートし、Cy を 7ビット目へ、0ビット目を Cy にセット | 0 0 0 0 0 ↑ | 1F | 1 | 4 | 4 | - |
| RLC r | r を左ローテートし、7ビット目を 0ビット目に、はみ出た 7ビット目を Cy にセット | ↑ ↓ 0 P 0 ↑ | (CB) 00uu urrr | 2 | 8 | 8 | `r` = `B, C, D, E, H, L, A` |
| RLC (HL) | (HL) を左ローテートし、7ビット目を 0ビット目に、はみ出た 7ビット目を Cy にセット | ↑ ↓ 0 P 0 ↑ | (CB) 00uu u110 | 2 | 15 | 15 | メモリ間接 |
| RLC (IX+d) | (IX+d) を左ローテートし、7ビット目を 0ビット目に、はみ出た 7ビット目を Cy にセット | ↑ ↓ 0 P 0 ↑ | (DD CB) d 00uu u110 | 4 | 23 | 23 | インデックス付き |
| RLC (IY+d) | (IY+d) を左ローテートし、7ビット目を 0ビット目に、はみ出た 7ビット目を Cy にセット | ↑ ↓ 0 P 0 ↑ | (FD CB) d 00uu u110 | 4 | 23 | 23 | インデックス付き |
| RL m | m を左ローテートし、Cy を 0ビット目へ、7ビット目を Cy にセット | ↑ ↓ 0 P 0 ↑ | (CB) 00uu u010 | 2 | 15 | 15 | - |
| RRC m | m を右ローテートし、0ビット目を 7ビット目に、はみ出た 0ビット目を Cy にセット | ↑ ↓ 0 P 0 ↑ | (CB) 00uu u001 | 2 | 15 | 15 | - |
| RR m | m を右ローテートし、Cy を 7ビット目へ、0ビット目を Cy にセット | ↑ ↓ 0 P 0 ↑ | (CB) 00uu u011 | 2 | 15 | 15 | - |
| SLA m | m を左シフトし、7ビット目を Cy にセットし、0ビット目は 0 にする | ↑ ↓ 0 P 0 ↑ | (CB) 00uu u100 | 2 | 15 | 15 | - |
| SRA m | m を右シフトし、0ビット目を Cy にセットし、7ビット目は変化しない | ↑ ↓ 0 P 0 ↑ | (CB) 00uu u101 | 2 | 15 | 15 | - |
| SRL m | m を右シフトし、0ビット目を Cy にセットし、7ビット目は 0 になる | ↑ ↓ 0 P 0 ↑ | (CB) 00uu u111 | 2 | 15 | 15 | - |
| RLD | A の下位 4 ビットを (HL) の下位 4 ビットへ、(HL) の上位 4 ビットを A の下位 4 ビットへ、(HL) の下位 4 ビットを (HL) の上位 4 ビットへセット | ↑ ↓ 0 P 0 - | (ED) 6F | 2 | 18 | 18 | - |
| RRD | A の下位 4 ビットを (HL) の上位 4 ビットへ、(HL) の下位 4 ビットを A の下位 4 ビットへ、(HL) の上位 4 ビットを (HL) の下位 4 ビットへセット | ↑ ↓ 0 P 0 - | (ED) 67 | 2 | 18 | 18 | - |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `↑` = 変化あり (セット)
- `↓` = 変化あり (リセット)
- `0` = クリア
- `-` = 無変化

---

## **📌 補足情報**
- `RLC` / `RL` は **左ローテート**
- `RRC` / `RR` は **右ローテート**
- `SLA` は **左シフト、0ビット目を 0 にする**
- `SRA` は **右シフト、7ビット目は変化しない**
- `SRL` は **右シフト、7ビット目を 0 にする**
- `RLD` / `RRD` は **(HL) の上位/下位 4 ビットと A の下位 4 ビットを交換**
- `(IX+d), (IY+d)` を使う場合は **(DD CB), (FD CB) プレフィックスが必要**

---

## **📌 例: 命令のオペコード**
**RLD の場合**
```assembly
RLD  ; A の下位4ビットと (HL) の下位4ビットを交換し、(HL) のビットを回転





# Z80 無条件ジャンプ命令・条件付きジャンプ命令

このドキュメントは Z80 の **無条件ジャンプ命令・条件付きジャンプ命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **無条件ジャンプ命令・条件付きジャンプ命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| JP nn | PC ← nn へ無条件ジャンプ | - - - - - - | C3 nn nn | 3 | 10 | 10 | - |
| JP cc, nn | フラグ条件 `cc` が真なら PC ← nn へジャンプ | - - - - - - | 11cc c010 | 3 | 10 | 10 | `cc` = `NZ, Z, NC, C, PO, PE, P, M` |
| JR e | PC ← PC+e へ相対ジャンプ | - - - - - - | 18 e | 2 | 12 | 12 | `e` は -126 〜 +129 の 8ビット相対値 |
| JR ff, e | フラグ条件 `ff` が真なら PC ← PC+e へ相対ジャンプ | - - - - - - | 00ff f000 e | 2 | 12 / 7 | 12 / 7 | `ff` = `NZ, Z, NC, C` |
| DJNZ e | B ← B-1, B≠0 なら PC ← PC+e へジャンプ | - - - - - - | 10 e | 2 | 13 / 8 | 13 / 8 | B=0 なら次の命令実行 |
| JP (HL) | PC ← HL へジャンプ | - - - - - - | E9 | 1 | 4 | 4 | - |
| JP (IX) | PC ← IX へジャンプ | - - - - - - | (DD) E9 | 2 | 8 | 8 | - |
| JP (IY) | PC ← IY へジャンプ | - - - - - - | (FD) E9 | 2 | 8 | 8 | - |

---

## **📌 フラグ条件**
| `cc` の値 | 条件 | 意味 |
|------------|------------|------------|
| `000` | NZ | Z=0 (ゼロでない) |
| `001` | Z | Z=1 (ゼロ) |
| `010` | NC | C=0 (キャリーなし) |
| `011` | C | C=1 (キャリーあり) |
| `100` | PO | P/V=0 (パリティ奇数) |
| `101` | PE | P/V=1 (パリティ偶数) |
| `110` | P | S=0 (正) |
| `111` | M | S=1 (負) |

| `ff` の値 | 条件 | 意味 |
|------------|------------|------------|
| `00` | NZ | Z=0 (ゼロでない) |
| `01` | Z | Z=1 (ゼロ) |
| `10` | NC | C=0 (キャリーなし) |
| `11` | C | C=1 (キャリーあり) |

---

## **📌 補足情報**
- `JP nn` は **16ビットアドレス (nn) へ無条件ジャンプ**
- `JP cc, nn` は **フラグの状態を判定して条件付きジャンプ**
- `JR e` は **現在の PC から相対ジャンプ (-126 〜 +129 の範囲)**
- `JR ff, e` は **条件付き相対ジャンプ**
- `DJNZ e` は **B をデクリメントし、0 でなければジャンプ**
- `JP (HL), JP (IX), JP (IY)` は **HL, IX, IY の値へジャンプ**

---

## **📌 例: 命令のオペコード**
**JP Z, 4000h の場合**
```assembly
JP Z, 4000h  ; Z フラグがセットされているとき、アドレス 4000h へジャンプ





# Z80 コール命令・リターン命令

このドキュメントは Z80 の **コール命令・リターン命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **コール命令・リターン命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| CALL nn | (SP-2) ← PC, PC ← nn | - - - - - - | CD nn nn | 3 | 17 | 17 | サブルーチン呼び出し |
| CALL cc, nn | フラグ条件 `cc` が真なら (SP-2) ← PC, PC ← nn | - - - - - - | 11cc c100 nn nn | 3 | 17 / 10 | 17 / 10 | `cc` = `NZ, Z, NC, C, PO, PE, P, M` |
| RET | PC ← (SP), SP ← SP+2 | - - - - - - | C9 | 1 | 10 | 10 | サブルーチンからのリターン |
| RET cc | フラグ条件 `cc` が真なら PC ← (SP), SP ← SP+2 | - - - - - - | 11cc c000 | 1 | 11 / 5 | 11 / 5 | `cc` = `NZ, Z, NC, C, PO, PE, P, M` |
| RETI | 割込み処理からのリターン | - - - - - - | (ED) 4D | 2 | 14 | 14 | マスク可能 (INT) 割込み用 |
| RETN | ノンマスカブル割込み (NMI) からのリターン | - - - - - - | (ED) 45 | 2 | 14 | 14 | NMI 用 |
| RST p | (SP-2) ← PC, PC ← p | - - - - - - | 11pp p111 | 1 | 11 | 11 | `p` = `00h, 08h, 10h, 18h, 20h, 28h, 30h, 38h` |

---

## **📌 フラグ条件**
| `cc` の値 | 条件 | 意味 |
|------------|------------|------------|
| `000` | NZ | Z=0 (ゼロでない) |
| `001` | Z | Z=1 (ゼロ) |
| `010` | NC | C=0 (キャリーなし) |
| `011` | C | C=1 (キャリーあり) |
| `100` | PO | P/V=0 (パリティ奇数) |
| `101` | PE | P/V=1 (パリティ偶数) |
| `110` | P | S=0 (正) |
| `111` | M | S=1 (負) |

| `p` の値 | 飛び先アドレス |
|------------|------------|
| `000` | `00h` |
| `001` | `08h` |
| `010` | `10h` |
| `011` | `18h` |
| `100` | `20h` |
| `101` | `28h` |
| `110` | `30h` |
| `111` | `38h` |

---

## **📌 補足情報**
- `CALL nn` は **PC をスタックに保存し、nn へジャンプ**
- `CALL cc, nn` は **フラグの状態を判定して条件付きジャンプ**
- `RET` は **スタックから PC を復元し、リターン**
- `RET cc` は **条件付きリターン**
- `RETI` は **割込み処理からのリターン (INT)**
- `RETN` は **NMI 割込みからのリターン**
- `RST p` は **CALL p の短縮版。固定アドレスにジャンプ**

---

## **📌 例: 命令のオペコード**
**RST 38h の場合**
```assembly
RST 38h  ; (SP-2) ← PC, PC ← 38h





# Z80 入出力命令

このドキュメントは Z80 の **入出力命令** に関する命令表です。  
**各命令のオペコード、フラグ、バイト数、マシンサイクル数など** を正確に記載しています。

---

## 📝 **入出力命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| IN A, (n) | A ← ポート `n` の入力 | - - - - - - | DB n | 2 | 11 | 11 | `0 ≤ n ≤ 255` |
| IN r, (C) | r ← ポート `C` の入力 | ↑ ↓ 0 P 0 0 | (ED) 01rr r000 | 2 | 12 | 12 | `r` = `A, B, C, D, E, H, L` |
| INI | (HL) ← ポート `C`、B--、HL++ | ↑ × × × 1 × | (ED) A2 | 2 | 16 | 16 | - |
| INIR | `INI` を B=0 になるまで繰り返す | ↑ × × × 1 × | (ED) B2 | 2 | 21 / 16 | 21 / 16 | B≠0 の時 繰り返し |
| IND | (HL) ← ポート `C`、B--、HL-- | ↑ × × × 1 × | (ED) AA | 2 | 16 | 16 | - |
| INDR | `IND` を B=0 になるまで繰り返す | ↑ × × × 1 × | (ED) BA | 2 | 21 / 16 | 21 / 16 | B≠0 の時 繰り返し |
| OUT (n), A | ポート `n` ← A | - - - - - - | D3 n | 2 | 11 | 11 | `0 ≤ n ≤ 255` |
| OUT (C), r | ポート `C` ← r | - - - - - - | (ED) 01rr r001 | 2 | 12 | 12 | `r` = `A, B, C, D, E, H, L` |
| OUTI | ポート `C` ← (HL)、B--、HL++ | ↑ × × × 1 × | (ED) A3 | 2 | 16 | 16 | - |
| OTIR | `OUTI` を B=0 になるまで繰り返す | ↑ × × × 1 × | (ED) B3 | 2 | 21 / 16 | 21 / 16 | B≠0 の時 繰り返し |
| OUTD | ポート `C` ← (HL)、B--、HL-- | ↑ × × × 1 × | (ED) AB | 2 | 16 | 16 | - |
| OTDR | `OUTD` を B=0 になるまで繰り返す | ↑ × × × 1 × | (ED) BB | 2 | 21 / 16 | 21 / 16 | B≠0 の時 繰り返し |

---

## **📌 フラグの意味**
| フラグ | 意味 |
|--------|------|
| `S` | 符号フラグ (Sign) |
| `Z` | ゼロフラグ (Zero) |
| `H` | ハーフキャリーフラグ (Half Carry) |
| `P/V` | パリティ/オーバーフロー (Parity/Overflow) |
| `N` | 演算フラグ (Add/Subtract) |
| `C` | キャリーフラグ (Carry) |

フラグの状態:
- `↑` = 変化あり (セット)
- `↓` = 変化あり (リセット)
- `×` = 未定

---

## **📌 補足情報**
- `IN A, (n)` は **ポート `n` の値を A に読み込む**
- `IN r, (C)` は **ポート `C` の値を r に読み込む**
- `INI` / `IND` は **ポート `C` から HL の指すメモリへ転送**
- `INIR` / `INDR` は **B=0 になるまで `INI` / `IND` を繰り返す**
- `OUT (n), A` は **A の値をポート `n` に書き込む**
- `OUT (C), r` は **r の値をポート `C` に書き込む**
- `OUTI` / `OUTD` は **HL の指すメモリの値をポート `C` へ転送**
- `OTIR` / `OTDR` は **B=0 になるまで `OUTI` / `OUTD` を繰り返す**

---

## **📌 例: 命令のオペコード**
**OUT (10h), A の場合**
```assembly
OUT (10h), A  ; A の値をポート 10h に出力





# Z80 拡張・補足情報

このセクションでは、**Z80 命令セットの補足情報** をまとめています。  
**基本命令セットには含まれていないが、知っておくと便利な情報** を記載しています。

---

## 📝 **特殊な `LD` 命令一覧**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| LD A, I | A ← I | * 0 * 0 * * | (ED) 57 | 2 | 9 | 9 | IFF2 の状態が P/V に入る |
| LD A, R | A ← R | * 0 * 0 * * | (ED) 5F | 2 | 9 | 9 | IFF2 の状態が P/V に入る |
| LD I, A | I ← A | - - - - - - | (ED) 47 | 2 | 9 | 9 | - |
| LD R, A | R ← A | - - - - - - | (ED) 4F | 2 | 9 | 9 | - |

### **📌 補足**
- `LD A, I` は **I レジスタ (割り込みベクタ) の値を A にロード**
- `LD A, R` は **R レジスタ (リフレッシュレジスタ) の値を A にロード**
- `LD I, A` は **A の値を I にロード**
- `LD R, A` は **A の値を R にロード**
- `IFF2` の状態が `P/V` フラグに反映されるため、割り込み制御と組み合わせて使われる

---

## 📝 **Z280 拡張命令: `MUL`**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| MUL D, E | DE ← D × E | ↑ ↓ - P/V 0 ↑ | (ED) 30 | 2 | 17 | 17 | Z280 のみ |

### **📌 補足**
- Z80 には **乗算 (`MUL`) 命令は存在しない** が、Z280 などの **上位互換 CPU** では `MUL` が追加されている
- `MUL D, E` は **D × E の結果を `DE` レジスタに格納**
- `P/V` フラグには **オーバーフロー情報がセットされる**

---

## 📝 **Z280/R800 拡張命令: `SLL`**
| 命令 | 機能 | フラグ (S Z H P/V N C) | 命令コード (16進) | バイト数 | マシンサイクル | ステート数 | 備考 |
|------|------|-----------------|-----------------|--------|--------------|--------|------|
| SLL r | r を左シフトし、0ビット目に 1 をセット | ↑ ↓ 0 P 0 ↑ | (CB) 11000rrr | 2 | 8 | 8 | `r` = `B, C, D, E, H, L, A` |
| SLL (HL) | (HL) を左シフトし、0ビット目に 1 をセット | ↑ ↓ 0 P 0 ↑ | (CB) 11000 110 | 2 | 15 | 15 | メモリ間接 |

### **📌 補足**
- Z80 **標準の SLA 命令と異なり、0ビット目に `1` をセットする**
- Z80 には存在しないが、**Z280 や R800 などの拡張 CPU では実装されている**
- `SLA` と混同しないよう注意 (`SLA` は 0ビット目に `0` をセット)

---

## 📝 **RST 命令の飛び先アドレス一覧**
| 命令 | 飛び先アドレス | 機能 |
|------|------------|------|
| RST 00h | `0000h` | ベクター割込み (INT 0) |
| RST 08h | `0008h` | - |
| RST 10h | `0010h` | - |
| RST 18h | `0018h` | - |
| RST 20h | `0020h` | - |
| RST 28h | `0028h` | - |
| RST 30h | `0030h` | - |
| RST 38h | `0038h` | 通常の割込みベクター |

### **📌 補足**
- `RST p` は `CALL p` の短縮版 (1バイトで呼び出し可能)
- `RST 38h` は **通常の割込みハンドラ** として使われることが多い
- `0000h` には **電源投入時のリセットベクタ** を配置することが一般的
- 各 `RST` アドレスには、簡易ハンドラや割込み処理を配置可能

---

## **📌 例: 命令のオペコード**
```assembly
LD A, I   ; A ← I レジスタの値をロード
MUL D, E  ; Z280: DE ← D × E
SLL A     ; Z280/R800: A を左シフトし、0ビット目に 1 をセット
RST 38h   ; 割込み発生時に PC を 38h にジャンプ
